<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1107px" preserveAspectRatio="none" style="width:1087px;height:1107px;" version="1.1" viewBox="0 0 1087 1107" width="1087px" zoomAndPan="magnify"><defs><filter height="300%" id="fxv0jovom85iz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="878.1113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="136" y="133.1094"/><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="914.7324" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="480" y="96.4883"/><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="914.7324" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="96.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="26" x2="26" y1="86.4883" y2="1020.2207"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="140.5" x2="140.5" y1="86.4883" y2="1020.2207"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="484.5" x2="484.5" y1="86.4883" y2="1020.2207"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="793.5" x2="793.5" y1="86.4883" y2="1020.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="8" y="83.5352">user</text><ellipse cx="26" cy="13" fill="#FEFECE" filter="url(#fxv0jovom85iz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26,21 L26,48 M13,29 L39,29 M26,48 L13,63 M26,48 L39,63 " fill="none" filter="url(#fxv0jovom85iz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="8" y="1032.7559">user</text><ellipse cx="26" cy="1045.709" fill="#FEFECE" filter="url(#fxv0jovom85iz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26,1053.709 L26,1080.709 M13,1061.709 L39,1061.709 M26,1080.709 L13,1095.709 M26,1080.709 L39,1095.709 " fill="none" filter="url(#fxv0jovom85iz)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="107.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="114.5" y="71.5352">Node 2</text><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="107.5" y="1019.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="114.5" y="1039.7559">Node 2</text><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="451.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="458.5" y="71.5352">Node 1</text><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="451.5" y="1019.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="458.5" y="1039.7559">Node 1</text><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="760.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="767.5" y="71.5352">Node 3</text><rect fill="#FEFECE" filter="url(#fxv0jovom85iz)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="760.5" y="1019.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="767.5" y="1039.7559">Node 3</text><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="878.1113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="136" y="133.1094"/><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="914.7324" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="480" y="96.4883"/><rect fill="#FFFFFF" filter="url(#fxv0jovom85iz)" height="914.7324" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="96.4883"/><polygon fill="#A80036" points="124,129.1094,134,133.1094,124,137.1094,128,133.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26" x2="130" y1="133.1094" y2="133.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="33" y="113.0566">RAFT.CLUSTER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="33" y="128.3672">JOIN &lt;node1&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="188" y1="193.041" y2="193.041"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="188" x2="188" y1="193.041" y2="206.041"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="188" y1="206.041" y2="206.041"/><polygon fill="#A80036" points="157,202.041,147,206.041,157,210.041,153,206.041" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="153" y="157.6777">cmdRaftCluster</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="161" y="172.9883">RaftReqSubmit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="169" y="188.2988">-&gt; RR_CLUSTER_JOIN</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="188" y1="265.9727" y2="265.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="188" x2="188" y1="265.9727" y2="278.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="188" y1="278.9727" y2="278.9727"/><polygon fill="#A80036" points="157,274.9727,147,278.9727,157,282.9727,153,278.9727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="153" y="230.6094">RaftReqHandleQueue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="161" y="245.9199">handleClusterJoin</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="169" y="261.2305">-&gt; state: REDIS_RAFT_JOINING</text><polygon fill="#A80036" points="468,380.8359,478,384.8359,468,388.8359,472,384.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="474" y1="384.8359" y2="384.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="153" y="303.541">HandleNodeStates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="161" y="318.8516">initiateNodeAdd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="177" y="334.1621">NodeConnect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="185" y="349.4727">sendNodeAddRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="193" y="364.7832">redisAsyncCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="201" y="380.0938">RAFT.NODE ADD 2 &lt;node1&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="490" x2="532" y1="460.0781" y2="460.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="532" y1="460.0781" y2="473.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="532" y1="473.0781" y2="473.0781"/><polygon fill="#A80036" points="501,469.0781,491,473.0781,501,477.0781,497,473.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="497" y="409.4043">cmdRaftNode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="505" y="424.7148">hasNodeIdBeenUsed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="505" y="440.0254">RaftReqSubmit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="505" y="455.3359">-&gt; RR_CFGCHANGE_ADDNODE</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="490" x2="532" y1="563.6309" y2="563.6309"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="532" y1="563.6309" y2="576.6309"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="532" y1="576.6309" y2="576.6309"/><polygon fill="#A80036" points="501,572.6309,491,576.6309,501,580.6309,497,576.6309" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="497" y="497.6465">RaftReqHandleQueue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="505" y="512.957">handleCfgChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="513" y="528.2676">addUsedNodeId(2)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="513" y="543.5781">raft_recv_entry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="521" y="558.8887">RAFT_LOGTYPE_ADD_NONVOTING_NODE</text><polygon fill="#A80036" points="157,601.9414,147,605.9414,157,609.9414,153,605.9414" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="151" x2="479" y1="605.9414" y2="605.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="163" y="601.1992">&lt;node_id&gt; &lt;dbid&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="188" y1="665.873" y2="665.873"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="188" x2="188" y1="665.873" y2="678.873"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="188" y1="678.873" y2="678.873"/><polygon fill="#A80036" points="157,674.873,147,678.873,157,682.873,153,678.873" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="153" y="630.5098">handleNodeAddResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="161" y="645.8203">addUsedNodeId(2)n  HandleClusterJoinCompleted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="169" y="661.1309">-&gt; state: REDIS_RAFT_UP</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="490" x2="532" y1="754.1152" y2="754.1152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="532" y1="754.1152" y2="767.1152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="532" y1="767.1152" y2="767.1152"/><polygon fill="#A80036" points="501,763.1152,491,767.1152,501,771.1152,497,767.1152" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="497" y="703.4414">raftNotifyMembershipEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="505" y="718.752">RAFT_MEMBERSHIP_ADD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="505" y="734.0625">RAFT_LOGTYPE_ADD_NONVOTING_NODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="513" y="749.373">addUsedNodeId(2)</text><polygon fill="#A80036" points="157,792.4258,147,796.4258,157,800.4258,153,796.4258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="479" y1="796.4258" y2="796.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="163" y="791.6836">&lt;&lt;replicate log&gt;&gt;</text><polygon fill="#A80036" points="777,821.7363,787,825.7363,777,829.7363,781,825.7363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="490" x2="783" y1="825.7363" y2="825.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="497" y="820.9941">&lt;&lt;replicate log&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="188" y1="900.9785" y2="900.9785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="188" x2="188" y1="900.9785" y2="913.9785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="188" y1="913.9785" y2="913.9785"/><polygon fill="#A80036" points="157,909.9785,147,913.9785,157,917.9785,153,913.9785" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="153" y="850.3047">raftNotifyMembershipEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="161" y="865.6152">RAFT_MEMBERSHIP_ADD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="161" y="880.9258">RAFT_LOGTYPE_ADD_NONVOTING_NODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="169" y="896.2363">addUsedNodeId(2)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="799" x2="841" y1="989.2207" y2="989.2207"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="841" x2="841" y1="989.2207" y2="1002.2207"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="800" x2="841" y1="1002.2207" y2="1002.2207"/><polygon fill="#A80036" points="810,998.2207,800,1002.2207,810,1006.2207,806,1002.2207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="806" y="938.5469">raftNotifyMembershipEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="814" y="953.8574">RAFT_MEMBERSHIP_ADD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="814" y="969.168">RAFT_LOGTYPE_ADD_NONVOTING_NODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="822" y="984.4785">addUsedNodeId(2)</text><!--MD5=[bc8e02b437d4160278a5b71d8de2dc48]
@startuml

actor user
participant "Node 2" as node2
participant "Node 1" as node1
participant "Node 3" as node3

activate node1
activate node3

user -> node2: RAFT.CLUSTER\nJOIN <node1>
activate node2
node2 -> node2: cmdRaftCluster\n  RaftReqSubmit\n    -> RR_CLUSTER_JOIN
node2 -> node2: RaftReqHandleQueue\n  handleClusterJoin\n    -> state: REDIS_RAFT_JOINING
node2 -> node1: HandleNodeStates\n  initiateNodeAdd\n      NodeConnect\n        sendNodeAddRequest\n          redisAsyncCommand\n            RAFT.NODE ADD 2 <node1>

node1 -> node1: cmdRaftNode\n  hasNodeIdBeenUsed\n  RaftReqSubmit\n  -> RR_CFGCHANGE_ADDNODE
node1 -> node1: RaftReqHandleQueue\n  handleCfgChange\n    addUsedNodeId(2)\n    raft_recv_entry\n      RAFT_LOGTYPE_ADD_NONVOTING_NODE
node1 - -> node2: <node_id> <dbid>

node2 -> node2: handleNodeAddResponse\n  addUsedNodeId(2)n  HandleClusterJoinCompleted\n    -> state: REDIS_RAFT_UP
node1 -> node1: raftNotifyMembershipEvent\n  RAFT_MEMBERSHIP_ADD\n  RAFT_LOGTYPE_ADD_NONVOTING_NODE\n    addUsedNodeId(2)
node1 -> node2: <<replicate log>>
node1 -> node3: <<replicate log>>

node2 -> node2: raftNotifyMembershipEvent\n  RAFT_MEMBERSHIP_ADD\n  RAFT_LOGTYPE_ADD_NONVOTING_NODE\n    addUsedNodeId(2)
node3 -> node3: raftNotifyMembershipEvent\n  RAFT_MEMBERSHIP_ADD\n  RAFT_LOGTYPE_ADD_NONVOTING_NODE\n    addUsedNodeId(2)

@enduml

PlantUML version 1.2020.05(Thu Mar 19 23:17:32 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 13.0.2+8
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: IL
--></g></svg>